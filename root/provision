#!/bin/sh
set -euo pipefail
cwd=$(dirname "$0")

echo -n "iptable-restore... "
iptables-restore --noflush < "$cwd/iptables.rules"
echo "ok"

echo -n "docker-compose... "
dcversion=$(curl -s https://api.github.com/repos/docker/compose/releases/latest | jq -r '.tag_name')
curl -fsSL --create-dirs https://github.com/docker/compose/releases/download/$dcversion/docker-compose-`uname -s`-`uname -m` -o /opt/bin/docker-compose
chown -R rancher /opt/bin
chmod -R +x /opt/bin
echo "ok"

echo -n "motd... "
mv -f "$cwd/../etc/motd" /etc/motd
chown root:root /etc/motd
chmod 0644 /etc/motd
echo "ok"
